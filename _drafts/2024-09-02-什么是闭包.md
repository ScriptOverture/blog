---
layout: post
title: 什么是闭包?
categories: [闭包]
description: 什么是闭包？它包裹的是什么东西？又为什么会导致内存泄露？你真的理解闭包吗？
keywords: 闭包, 作用域, 词法环境
--- 

### 前言

这篇文章将讲解 `JavaScript` 中的闭包, 说明闭包的定义理解日常使用优缺点, 以及博主各阶段对其误解。

### 误解

在刚学习 javascript 那会, 只是知道闭包有解决`for(var i = 0; i < len; i++)`循环内正确获取索引的妙用。  

查了查百度面试宝典通常一笔带过: 函数内使用外部变量被意味闭包。emm 其实那个阶段对这个概念还是很模糊。

后来了解了其他语言的内存模型后, 有了一个比较另类的视角; 变量在声明内存到销毁有一段存活的生命周期, 而一般当变量所在作用域执行完毕时, 就会执行内存销毁; 那么如果存在某种操作可以将变量的生命周期延长, 也就是当所在的作用域执行完毕，该变量任然存活。
在 JS 中有很多操作可以延长生命周期比如: 上层作用域的变量, 异步操作, 闭包; 这里异步操作和闭包操作是等价的(这个后面再说);


当时我直接将这个概念类比闭包来理解的, 直到某天回想:

如果这样的话那为什么要叫做闭包呀？立马打开[MDN][2];

这是`MDN`给出的第一个闭包示例。
```javascript
function init() {
  var name = "Mozilla"; // name 是一个被 init 创建的局部变量
  function displayName() {
    // displayName() 是内部函数，一个闭包
    alert(name); // 使用了父函数中声明的变量
  }
  displayName();
}
init();
```
观察发现上面俩种解释都不成立:
- displayName 在 init 作用域内执行
- 并没有延长name变量的生命周期



```javascript
let data;

function test_1() {
    const struct = {
        name: "???",
        age: 18
    };

    data = struct
}


function test_2() {
    console.log(data);
}

test_1();
test_2();
```


### 什么是闭包

闭包（closure）是一个函数以及其捆绑的周边环境状态（lexical environment，词法环境）的引用的组合。换而言之，闭包让开发者可以从内部函数访问外部函数的作用域。在 JavaScript 中，闭包会随着函数的创建而被同时创建


### 闭包优缺点

### 总结



[1]: https://zh.wikipedia.org/wiki/%E9%97%AD%E5%8C%85_(%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A7%91%E5%AD%A6)

[2]: https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Closures